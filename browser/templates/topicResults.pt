<tal:block tal:define="view options/view">
  <ol>
    <tal:block tal:repeat="topic view/get_results">
      <li id="abc123" tal:attributes="id topic/topic_id">
        <a class="topic" href="#"
          tal:attributes="href string:/r/topic/${topic/last_post_id}"
          tal:content="topic/subject"/>
        <span class="groupInfo" tal:condition="topic/show_group">
          Group:
          <a class="group" href="#" 
            tal:attributes="href string:/groups/group/${topic/group_id};"
            tal:content="topic/group_name"/>
        </span>
        <span class="postCount">
          <span class="cardinal" tal:content="topic/num_posts"/>
          posts
        </span>
        <span class="dates">
            Last post:
            <span class="date" tal:content="topic/last_post_date"/>
        </span>
        <ul class="keywords">
          <tal:block tal:repeat="keyword topic/keywords">
            <li tal:content="keyword/word"></li>
          </tal:block>
        </ul>
        <div class="refine"
          tal:define="buttonId string:refineOptionsButton${topic/topic_id};
            optionsId string:refineOptions${topic/topic_id}">
          <div class="showrefine">
            <a href="#" id="abc123"
              tal:attributes="id buttonId;
                href string:javascript:showHideInline('${optionsId}','${buttonId}')"
              title="Refine the results">&#9654;</a>
          </div>
          <div class="refineOptions" id="abc123" style="display:none;"
            tal:attributes="id optionsId">
            <div>
              <ul>
                <li tal:condition="topic/show_group">
                  <a tal:attributes="href python:view.view.get_search_url(groupId=topic['group_id'])"
                    href="#">Only search the group
                    <cite class="group" tal:content="topic/group_name">A Group Name</cite></a>
                </li>
                <li>
                  <a tal:attributes="href python:view.view.get_search_url(searchText=map(lambda w:w['word'], topic['keywords']))"
                    href="#">Search for documents related to
                    <cite tal:content="topic/subject">this topic</cite></a>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </li>
    </tal:block>
  </ol>
</tal:block>
